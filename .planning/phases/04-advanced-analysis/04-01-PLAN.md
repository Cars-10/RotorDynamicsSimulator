# Plan: Analysis Data Infrastructure

## Objective
Establish the data structures and computational backend required for advanced rotor dynamics analysis (Campbell Diagrams and Stability Maps).

## Execution Context
- **Source**: `src/types.ts`, `src/workers/analysisWorker.ts`, `src/hooks/useAnalysis.ts`
- **Goal**: Offload heavy matrix calculations to a Web Worker and define the schema for analysis results.

## Context
Phase 4 requires calculating natural frequencies and damping factors across a wide range of rotor speeds (e.g., 0 to 10,000 RPM in 100 RPM increments). Doing this on the main thread will freeze the UI. We need a dedicated Web Worker and a structured way to store this "Multi-Speed" data, which differs from the single-speed `SimulationData` we currently have.

## Tasks
- [ ] **Define Types**: Update `src/types.ts` to include:
    - `CampbellPoint`: `{ rpm: number, modes: { frequency: number, damping: number, whirl: 'forward'|'backward'|'mixed' }[] }`
    - `AnalysisResult`: `{ points: CampbellPoint[], criticalSpeeds: number[], stabilityThreshold: number }`
- [ ] **Create Web Worker**: Initialize `src/workers/analysisWorker.ts`.
    - Implement a mock calculation loop that generates realistic-looking Campbell data (frequencies increasing/splitting with speed).
    - Use `postMessage` to communicate with the main thread.
- [ ] **Create Hook**: Implement `src/hooks/useAnalysis.ts`.
    - Manage the Worker instance.
    - Expose `runAnalysis(config: AnalysisConfig)` and `results: AnalysisResult | null`.
    - Handle loading states and errors.
- [ ] **Unit Test**: Verify the worker communication and data structure integrity.

## Verification
- **Test**: `useAnalysis.test.ts` should successfully spawn the worker, send a request, and receive a formatted `AnalysisResult`.
- **Manual**: Trigger an analysis from a temporary button and log the results to the console.

## Success Criteria
- [ ] `AnalysisResult` type is defined and exported.
- [ ] `analysisWorker.ts` exists and can generate mock data.
- [ ] `useAnalysis` hook correctly manages the worker lifecycle.
- [ ] "Analysis Complete" log appears with correct data structure.

## Output
- `src/types.ts` (modified)
- `src/workers/analysisWorker.ts`
- `src/hooks/useAnalysis.ts`
- `src/hooks/useAnalysis.test.ts`
